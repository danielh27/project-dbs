<div class="container">
  <div class="row">
    <div class="col-3">
      <h2>Mensajes <span><%= @chats.size %></span></h2>
      <div data-controller="search-message">
        <div>
          <%= form_with url: service_chat_path(@service, @chat),
                        method: :get,
                        html: { data: { search_message_target: 'form' } } do |form| %>
            <i class="fa-solid fa-magnifying-glass"></i>
            <%= form.text_field :query,
                                value: params[:query],
                                placeholder: 'Busca un mensaje',
                                data: { search_message_target: "input", action: "turbo:keyup->search-message#filter" } %>
          <% end %>
        </div>

        <div data-search-message-target="messages">
          <% @chats.each do |chat| %>
            <%= cl_image_tag chat.provider.avatar.key, class: "avatar", alt: "avatar" %>
            <%= chat.provider.first_name %>
            <%= chat.messages.last.content %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-6">
      <div class="chatroom"
            data-controller="chat-subscription"
            data-chat-subscription-chat-id-value="<%= @chat.id %>">

        <h1>#<%= @chat.name %></h1>

        <div class="messages" data-chat-subscription-target="messages">
          <% @chat.messages.each do |message| %>
            <%= render 'messages/message', message: message %>
          <% end %>
        </div>

        <%= simple_form_for [@service, @chat, @message],
            html: { data: { action: "turbo:submit-end->chat-subscription#resetForm" },
            class: "d-flex"} do |f| %>
          <%= f.input :content,
                      label: false,
                      placeholder: "Message ##{@chat.name}",
                      wrapper_html: { class: "flex-grow-1" }
          %>
          <%= f.submit "Send", class: "btn btn-primary mb-3" %>
        <% end %>
      </div>
    </div>

    <div class="col-3">
      <h2>Mis Cotizaciones</h2>
      <p>Cotizaciones formales</p>
    </div>
  </div>
</div>
